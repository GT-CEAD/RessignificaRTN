"0","library(xlsx)"
"0","library(XLConnect)"
"0","library(tidyr)"
"0","library(RCurl)"
"0","library(ckanr)"
"0","ultima_carga<-"""""
"0","load(""todas_series.Rdata"")"
"0","tb_ckan<-resource_show(id=""527ccdb1-3059-42f3-bf23-b5e3ab4c6dc6"",url=""https://www.tesourotransparente.gov.br/ckan"")"
"0","mudou<- (tb_ckan$last_modified!=ultima_carga)"
"0","if (mudou){"
"0","  ultima_carga<- tb_ckan$last_modified"
"0","  URL_add <- tb_ckan$url"
"0","  tmp = paste(getwd(),""temp.xlsx"")"
"0","  "
"0","  "
"0","  tmp = tempfile(fileext = "".xlsx"")"
"0","  "
"0","  "
"0","  "
"0","  download.file(URL_add,mode = ""wb"", destfile = tmp)"
"0","  rtn_geral <- read.xlsx(tmp, sheetIndex=2, rowIndex = c(5:79))"
"0","  rtn_receita<-read.xlsx(tmp, sheetIndex=4, rowIndex = c(5:53))"
"0","  rtn_despesa<- read.xlsx(tmp, sheetIndex=8, rowIndex = c(5:91))"
"0","  deflator_IPCA <- read.xlsx(tmp,sheetIndex=5, rowIndex = c(55:55),header=FALSE) #vai ser sempre a Ãºltima linha de receita + 2"
"0","  names(deflator_IPCA)<-names(rtn_receita)"
"0","  "
"0","  "
"0","  names(rtn_geral)[1]<-""Rubrica"""
"0","  series_temporais_analise<-gather(rtn_geral,Data, Valor,-Rubrica)"
"0","  series_temporais_analise$Data<-gsub(""X"","""",series_temporais_analise$Data)"
"0","  series_temporais_analise$Data<-as.Date(as.numeric(series_temporais_analise$Data), origin=""1899-12-30"")"
"0","  series_temporais_analise$Valor <-as.numeric(series_temporais_analise$Valor)"
"0","  series_temporais_analise$Valor[is.na(series_temporais_analise$Valor)]<-0"
"0","  rm(rtn_geral)"
"0","  "
"0","  "
"0","  names(rtn_receita)[1]<-""Rubrica"""
"0","  series_temporais_analise_rec<-gather(rtn_receita,Data, Valor,-Rubrica)"
"0","  series_temporais_analise_rec$Data<-gsub(""X"","""",series_temporais_analise_rec$Data)"
"0","  series_temporais_analise_rec$Data<-as.Date(as.numeric(series_temporais_analise_rec$Data), origin=""1899-12-30"")"
"0","  series_temporais_analise_rec$Valor <-as.numeric(series_temporais_analise_rec$Valor)"
"0","  series_temporais_analise_rec$Valor[is.na(series_temporais_analise_rec$Valor)]<-0"
"0","  rm(rtn_receita)"
"0","  "
"0","  names(rtn_despesa)[1]<-""Rubrica"""
"0","  series_temporais_analise_desp<-gather(rtn_despesa,Data, Valor,-Rubrica)"
"0","  series_temporais_analise_desp$Data<-gsub(""X"","""",series_temporais_analise_desp$Data)"
"0","  series_temporais_analise_desp$Data<-as.Date(as.numeric(series_temporais_analise_desp$Data), origin=""1899-12-30"")"
"0","  series_temporais_analise_desp$Valor <-as.numeric(series_temporais_analise_desp$Valor)"
"0","  series_temporais_analise_desp$Valor[is.na(series_temporais_analise_desp$Valor)]<-0"
"0","  rm(rtn_despesa)"
"0","  "
"0","  names(deflator_IPCA)[1]<-""Rubrica"""
"0","  series_temporais_analise_IPCA<-gather(deflator_IPCA,Data, Valor,-Rubrica)"
"0","  series_temporais_analise_IPCA$Data<-gsub(""X"","""",series_temporais_analise_IPCA$Data)"
"0","  series_temporais_analise_IPCA$Data<-as.Date(as.numeric(series_temporais_analise_IPCA$Data), origin=""1899-12-30"")"
"0","  series_temporais_analise_IPCA$Valor <-as.numeric(series_temporais_analise_IPCA$Valor)"
"0","  rm(deflator_IPCA)"
"0","  "
"0","  URL_add<-""http://www.tesourotransparente.gov.br/ckan/dataset/ab56485b-9c40-4efb-8563-9ce3e1973c4b/resource/7a535375-4e15-4ebb-bb49-25daf05330bb/download/Metadados---NFGC.xlsx"""
"0","  "
"0","  tmp = paste(getwd(),""temp.xlsx"")"
"0","  "
"0","  "
"0","  tmp = tempfile(fileext = "".xlsx"")"
"0","  "
"0","  download.file(URL_add,mode = ""wb"", destfile = tmp)"
"0","  metadados_rec<- read.xlsx(tmp, sheetIndex=2, startRow = 5, colIndex = c(1,2))"
"0","  metadados_desp<-read.xlsx(tmp, sheetIndex=8, startRow = 5, colIndex = c(1,2))"
"0","  names(metadados_rec)<-c(""Rubrica"",""Descricao"")"
"0","  names(metadados_desp) <- names(metadados_rec)"
"0","  "
"0","  "
"0","  "
"0","  save(list = ls(),file = ""todas_series.Rdata"")"
"0","  rm(series_temporais_analise)"
"0","  "
"0","}"
